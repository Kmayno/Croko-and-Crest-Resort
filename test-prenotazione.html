<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Prenotazione</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input,
      select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      .result {
        margin-top: 20px;
        padding: 10px;
        border-radius: 4px;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Test Endpoint Prenotazione</h1>

      <div class="form-group">
        <label for="clienteId">ID Cliente:</label>
        <input type="number" id="clienteId" value="1" />
      </div>

      <div class="form-group">
        <label for="cameraId">ID Camera:</label>
        <input type="number" id="cameraId" value="1" />
      </div>

      <div class="form-group">
        <label for="dataInizio">Data Inizio:</label>
        <input type="date" id="dataInizio" />
      </div>

      <div class="form-group">
        <label for="dataFine">Data Fine:</label>
        <input type="date" id="dataFine" />
      </div>

      <div class="form-group">
        <label for="opzioni">Opzioni (separate da virgola):</label>
        <input type="text" id="opzioni" placeholder="1,2,3" />
      </div>

      <button onclick="testConnection()">Test Connessione</button>
      <button onclick="testRawJson()">Test JSON Raw</button>
      <button onclick="testDataEndpoint()">Test Ricezione Dati</button>
      <button onclick="testEndpoint()">Test Endpoint Completo</button>

      <div id="result"></div>
    </div>

    <script>
      // Imposta date di default
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      const dayAfter = new Date(today);
      dayAfter.setDate(dayAfter.getDate() + 2);

      document.getElementById("dataInizio").value = tomorrow
        .toISOString()
        .split("T")[0];
      document.getElementById("dataFine").value = dayAfter
        .toISOString()
        .split("T")[0];

      async function testConnection() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<div>Test connessione in corso...</div>";

        try {
          console.log(
            "Test connessione a: http://localhost:8080/api/prenotazioni/test"
          );

          const response = await fetch(
            "http://localhost:8080/api/prenotazioni/test",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            }
          );

          const result = await response.text();
          console.log("Risposta connessione:", result);

          if (response.ok) {
            resultDiv.innerHTML = `<div class="result success">
               <h3>✅ Connessione OK!</h3>
               <p>Status: ${response.status}</p>
               <p>Risposta: ${result}</p>
             </div>`;
          } else {
            resultDiv.innerHTML = `<div class="result error">
               <h3>❌ Errore ${response.status}</h3>
               <p>Messaggio: ${result}</p>
             </div>`;
          }
        } catch (error) {
          console.error("Errore connessione:", error);
          resultDiv.innerHTML = `<div class="result error">
             <h3>❌ Errore di Connessione</h3>
             <p>${error.message}</p>
             <p>Verifica che il server sia attivo su localhost:8080</p>
           </div>`;
        }
      }

      async function testRawJson() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<div>Test JSON raw in corso...</div>";

        try {
          const requestData = {
            idCliente: parseInt(document.getElementById("clienteId").value),
            idCamera: parseInt(document.getElementById("cameraId").value),
            dataInizio: document.getElementById("dataInizio").value,
            dataFine: document.getElementById("dataFine").value,
            opzioniIds: document.getElementById("opzioni").value
              ? document
                  .getElementById("opzioni")
                  .value.split(",")
                  .map((id) => parseInt(id.trim()))
              : [],
          };

          const jsonString = JSON.stringify(requestData);
          console.log("Invio JSON raw:", jsonString);

          const response = await fetch(
            "http://localhost:8080/api/prenotazioni/test-raw",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: jsonString,
            }
          );

          const result = await response.text();
          console.log("Risposta JSON raw:", result);

          if (response.ok) {
            resultDiv.innerHTML = `<div class="result success">
               <h3>✅ JSON Raw OK!</h3>
               <p>Status: ${response.status}</p>
               <pre>${result}</pre>
             </div>`;
          } else {
            resultDiv.innerHTML = `<div class="result error">
               <h3>❌ Errore ${response.status}</h3>
               <p>Messaggio: ${result}</p>
             </div>`;
          }
        } catch (error) {
          console.error("Errore JSON raw:", error);
          resultDiv.innerHTML = `<div class="result error">
             <h3>❌ Errore di Connessione</h3>
             <p>${error.message}</p>
           </div>`;
        }
      }

      async function testEndpoint() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<div>Test in corso...</div>";

        try {
          const requestData = {
            idCliente: parseInt(document.getElementById("clienteId").value),
            idCamera: parseInt(document.getElementById("cameraId").value),
            dataInizio: document.getElementById("dataInizio").value,
            dataFine: document.getElementById("dataFine").value,
            opzioniIds: document.getElementById("opzioni").value
              ? document
                  .getElementById("opzioni")
                  .value.split(",")
                  .map((id) => parseInt(id.trim()))
              : [],
          };

          console.log("Invio dati:", requestData);

          const response = await fetch(
            "http://localhost:8080/api/prenotazioni/addPrenotazione",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(requestData),
            }
          );

          const result = await response.json();
          console.log("Risposta:", result);

          if (response.ok) {
            resultDiv.innerHTML = `<div class="result success">
                        <h3>✅ Successo!</h3>
                        <p>Status: ${response.status}</p>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>`;
          } else {
            resultDiv.innerHTML = `<div class="result error">
                        <h3>❌ Errore ${response.status}</h3>
                        <p>Messaggio: ${result}</p>
                    </div>`;
          }
        } catch (error) {
          console.error("Errore:", error);
          resultDiv.innerHTML = `<div class="result error">
                    <h3>❌ Errore di Connessione</h3>
                    <p>${error.message}</p>
                </div>`;
        }
      }

      async function testDataEndpoint() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<div>Test ricezione dati in corso...</div>";

        try {
          const requestData = {
            idCliente: parseInt(document.getElementById("clienteId").value),
            idCamera: parseInt(document.getElementById("cameraId").value),
            dataInizio: document.getElementById("dataInizio").value,
            dataFine: document.getElementById("dataFine").value,
            opzioniIds: document.getElementById("opzioni").value
              ? document
                  .getElementById("opzioni")
                  .value.split(",")
                  .map((id) => parseInt(id.trim()))
              : [],
          };

          console.log("Invio dati test:", requestData);

          const response = await fetch(
            "http://localhost:8080/api/prenotazioni/test-data",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(requestData),
            }
          );

          const result = await response.text();
          console.log("Risposta test:", result);

          if (response.ok) {
            resultDiv.innerHTML = `<div class="result success">
                        <h3>✅ Test Ricezione Dati Riuscito!</h3>
                        <p>Status: ${response.status}</p>
                        <pre>${result}</pre>
                    </div>`;
          } else {
            resultDiv.innerHTML = `<div class="result error">
                        <h3>❌ Errore ${response.status}</h3>
                        <p>Messaggio: ${result}</p>
                    </div>`;
          }
        } catch (error) {
          console.error("Errore test:", error);
          resultDiv.innerHTML = `<div class="result error">
                    <h3>❌ Errore di Connessione</h3>
                    <p>${error.message}</p>
                </div>`;
        }
      }
    </script>
  </body>
</html>
